amends "pkl:test"

import "pkl:test"

import "../../tests.pkl"
import "../../velocity.pkl"
import "../../primitives/command.pkl"

// Command validation
local cmd1 = (velocity) {
    tests {
        new {
            name = "Invalid command"
            commands {
                new tests.InvalidCommand {}
            }
        }
    }
}

local cmd2 = (velocity) {
    tests {
        new {
            name = "Valid command"
            commands {
                new tests.RequireBuildCommand {
                    name = "test"
                }
            }
        }
    }
    builds {
        new {
            name = "test"
        }
    }
}


facts {
    ["invalid command"] {
        test.catchOrNull(() -> cmd1.validateTests(cmd1.getNames())).contains("test: 'Invalid command' has command errors")
    }
    ["valid command"] {
        test.catchOrNull(() -> cmd2.validateTests(cmd2.getNames())) == null
    }
}
